package org.jahia.modules.businessdirectory.rules

// list any import classes here.
import org.jahia.services.content.rules.*
import org.jahia.services.content.JCRContentUtils
import org.slf4j.Logger

expander rules.dsl

// declare any global variables here
global User user
global Service service
global Logger logger
global JCRContentUtils jcrUtils

rule "Add manager edit rights on team"
	when
		/*if a manager is set*/
		A property manager has been set on a node
        	- the node has the type busdirnt:team
	then
		/*this manager has edit rights on this team*/
		Log "give edit rights to manager " + node.getNode().getProperty("manager").getNode().getName()
		> String userToSet = node.getNode().getProperty("manager").getNode().getName();
		//Grant role editor on the node to the user userToSet
		> service.grantRoleToUser(node, userToSet, "editor", drools);
		
end

rule "Add employee edit rights on employee"
	when
	//if a employee is added
		A new node is created
        	- the node has the type busdirnt:employee
	then
		/*this employee has edit rights on its content*/
		Log "give edit rights to" + node.getName()
		> service.grantRoleToUser(node, node.getName(), "editor", drools);
end
